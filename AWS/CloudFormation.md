# AWS Cloudformation이란?

AWS CloudFormation은 **AWS 리소스를 코드로 정의하고 자동으로 생성, 업데이트, 삭제할 수 있게 해주는 인프라스트럭처 자동화 서비스**입니다. 쉽게 말해, 인프라를 코드(Infrastructure as Code, IaC)로 관리할 수 있게 해주는 도구입니다.

---

## ✅ 핵심 개념 요약

| 항목              | 설명                           |
| --------------- | ---------------------------- |
| **목적**          | AWS 리소스를 코드로 선언하고 일관되게 프로비저닝 |
| **형식**          | JSON 또는 YAML 형식의 템플릿         |
| **관리 단위**       | Stack (리소스의 논리적 그룹)          |
| **IaC 도구와의 차이** | Terraform 등과 비슷하지만 AWS 전용 도구 |

---

## 🧱 동작 구조

1. **CloudFormation Template 작성**

   * YAML 또는 JSON으로 작성
   * 어떤 리소스(VPC, EC2, S3 등)를 어떤 속성으로 만들지 선언

2. **Stack 생성**

   * 템플릿을 기반으로 CloudFormation이 자동으로 리소스 생성
   * 생성된 리소스는 Stack 단위로 관리됨

3. **변경 관리**

   * 템플릿 수정 후 Stack 업데이트 → 변경 사항만 적용됨 (Change Set으로 검토 가능)

4. **삭제**

   * Stack 삭제 시, 포함된 리소스들도 함께 제거됨

---

## 📄 예시 (간단한 EC2 인스턴스 생성 템플릿 - YAML)

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: EC2 인스턴스를 생성하는 예제

Resources:
  MyEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.micro
      ImageId: ami-0abcdef1234567890
```

---

## 🛠 주요 구성 요소

| 구성 요소           | 설명                                        |
| --------------- | ----------------------------------------- |
| **Template**    | 리소스를 정의한 파일 (JSON/YAML)                   |
| **Stack**       | 하나의 템플릿으로 생성된 모든 리소스 그룹                   |
| **Parameters**  | 템플릿의 입력값 (재사용 가능성 ↑)                      |
| **Mappings**    | 리전별 값 매핑 등                                |
| **Conditions**  | 특정 조건일 때만 리소스 생성                          |
| **Outputs**     | Stack 생성 후 노출하고 싶은 정보 (예: EC2의 Public IP) |
| **Change Sets** | 업데이트 전 변경 내역을 미리 검토 가능                    |

---

## 💡 장점

* **자동화**: 복잡한 리소스 생성 과정을 자동화
* **일관성**: 같은 템플릿으로 반복 배포 가능
* **버전 관리 가능**: IaC로 관리하면서 Git 등으로 버전 추적
* **롤백 지원**: 실패 시 자동 롤백

---

## ⚠️ 주의할 점

* **복잡한 템플릿**은 디버깅이 어려울 수 있음
* **리소스 의존성**을 명확히 지정하지 않으면 순서 오류 발생 가능
* **외부 리소스** (예: 수동 생성된 리소스)와 충돌 가능

---

## 🆚 Terraform과의 비교

| 항목      | CloudFormation | Terraform                              |
| ------- | -------------- | -------------------------------------- |
| 범용성     | AWS 전용         | 멀티 클라우드 지원 (AWS, GCP 등)                |
| 선언 언어   | YAML, JSON     | HashiCorp Configuration Language (HCL) |
| 상태 관리   | AWS 내부에서 자동 관리 | 로컬 또는 원격 상태 파일로 수동 관리 필요               |
| 커뮤니티 지원 | AWS 공식 지원      | 오픈소스 커뮤니티 중심                           |

---

## 📌 언제 쓰면 좋은가?

* AWS에만 집중된 인프라를 코드로 관리하고 싶은 경우
* EC2, RDS, VPC 등 AWS 리소스를 반복적으로 생성/삭제해야 하는 경우
* CI/CD와 통합해 자동 배포 파이프라인을 구성하고 싶은 경우

---


# 사용 중인 모든 리소스를 왜 스택이라 부르는가?

**AWS CloudFormation에서 ‘스택(Stack)’이라고 부르는 이유**는 \*\*"서로 연관된 리소스들의 논리적인 묶음"\*\*이기 때문이야.

---

## 📌 왜 "Stack"이라고 부르는가?

### 1. **하나의 템플릿 → 여러 리소스 생성**

CloudFormation 템플릿 하나로 다음과 같이 여러 리소스를 한 번에 만들 수 있음:

* VPC
* Subnet
* Security Group
* EC2
* IAM Role
* RDS …

이렇게 한 번에 배포된 리소스 묶음을 **Stack**이라고 부름.

> 즉, "이 프로젝트의 인프라 구성 전체"를 하나의 Stack으로 관리한다는 개념이야.

---

### 2. **의존성과 순서가 있는 구조**

리소스들은 서로 의존성을 가짐:

* EC2 → Subnet → VPC
* RDS → SecurityGroup → VPC

CloudFormation은 이 의존성을 고려해 순서대로 리소스를 **"쌓아 올리듯이(Stack)"** 배포하고,
문제가 생기면 자동으로 롤백까지 해줌.

---

### 3. **Stack 단위로 관리**

* 생성(Create), 수정(Update), 삭제(Delete)를 모두 Stack 단위로 수행
* 예: `MyAppStack`을 삭제하면, 그 안의 모든 EC2, RDS, S3 등도 자동 삭제됨

---

### 4. **클라우드 애플리케이션의 논리적 구성 단위**

Stack은 “이 애플리케이션에 필요한 모든 인프라 리소스”의 집합이기 때문에,
**클라우드 애플리케이션 구성 단위를 논리적으로 묶는 역할**도 해.

---

## 🔁 비유하자면?

> CloudFormation Stack은 **"레고 블록 세트"** 같음.

* 하나의 세트(템플릿)로 레고를 조립(리소스 생성)
* 그 세트를 통째로 다시 만들 수도 있고,
* 통째로 분해(삭제)도 가능

---

## ✅ 정리

| 이유     | 설명                                      |
| ------ | --------------------------------------- |
| 묶음 관리  | 여러 리소스를 하나의 단위로 묶어서 관리                  |
| 의존성 처리 | 리소스 간 순서를 고려해서 자동 생성                    |
| 자동화    | 전체 인프라를 코드로 정의하고 통제                     |
| 반복 가능성 | 같은 Stack을 여러 환경(dev/stage/prod)에 재사용 가능 |

---

필요하다면 "하나의 리소스를 여러 Stack에 넣을 수 있는가?", "Stack 간 참조는 어떻게 하는가?" 같은 고급 개념도 이어서 설명해줄 수 있어. 궁금한 거 있으면 바로 이어서 질문해줘.

