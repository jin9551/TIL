# S3 객체의 주소

S3 객체의 **주소(Object URL)** 개념과 구조, 그리고 주의할 점까지 정리해 드릴게요.

---

## 1. S3 객체 주소의 기본 개념

S3 객체는 HTTP(S)로 접근할 수 있는 **고유한 URL**을 가집니다.
이 URL을 **S3 Object URL**이라고 부르며, 접근 방식에 따라 크게 두 가지 형식이 있습니다.

1. **가상 호스팅 방식(Virtual-hosted–style URL)** ← 현재 AWS 권장
2. **경로 방식(Path-style URL)** ← 구형, 2020년부터 대부분 비권장

---

## 2. 주소 형식

### (1) Virtual-hosted–style URL (권장)

```
https://{bucket-name}.s3.{region}.amazonaws.com/{object-key}
```

* **bucket-name**: 전역 유일한 버킷 이름
* **region**: 버킷이 생성된 AWS 리전
* **object-key**: 객체의 Key(경로 포함)
* 예시:

```
https://my-photo-bucket.s3.ap-northeast-2.amazonaws.com/images/profile.jpg
```

* **특징**

  * 버킷 이름이 서브도메인 역할
  * 리전을 명시해야 지연·요금이 정확
  * 퍼블릭 접근 허용(정책/ACL) 상태여야 웹 브라우저에서 바로 열림

---

### (2) Path-style URL (구형)

```
https://s3.{region}.amazonaws.com/{bucket-name}/{object-key}
```

* 예시:

```
https://s3.ap-northeast-2.amazonaws.com/my-photo-bucket/images/profile.jpg
```

* **주의**: AWS는 신규 리전에서는 기본 지원 안 함.
  (S3 Access Points나 일부 특수 케이스에서만 필요)

---

## 3. S3 콘솔에서 보이는 URL

AWS S3 콘솔에서 객체 클릭 → **"Object URL"** 항목을 보면 Virtual-hosted–style 주소를 제공.
단, **접근 권한이 없으면 브라우저에서 403 Forbidden**.

---

## 4. 퍼블릭 URL과 보안

* **퍼블릭 접근**:

  * 버킷 정책, ACL, Block Public Access 설정에 따라 공개 여부 결정.
  * 퍼블릭이면 누구나 URL로 접근 가능.
* **비공개 접근**:

  * 직접 URL로 접근해도 403 Forbidden
  * \*\*프리사인 URL(Presigned URL)\*\*로 임시 접근 허용 가능

---

## 5. 프리사인 URL 예시 (AWS CLI)

```bash
aws s3 presign s3://my-photo-bucket/images/profile.jpg --expires-in 3600
```

→ 유효 시간(초 단위) 동안 서명된 URL 생성:

```
https://my-photo-bucket.s3.ap-northeast-2.amazonaws.com/images/profile.jpg?X-Amz-Algorithm=...
```

* **특징**: 권한 없는 사용자도 일정 시간 동안 다운로드/업로드 가능

---

## 6. 특수한 주소 형태

1. **S3 Access Point URL**

```
https://[AccessPointName]-[AccountID].s3-accesspoint.[region].amazonaws.com
```

2. **S3 on Outposts URL**

```
https://[AccessPointName]-[AccountID].s3-outposts.[region].amazonaws.com
```

3. **CloudFront 배포 도메인**

   * S3를 직접 노출하는 대신 CDN으로 배포하는 경우:

```
https://d111111abcdef8.cloudfront.net/images/profile.jpg
```

* 보안·성능·도메인 커스터마이징 용이

---

## 7. 주소 설계 시 주의점

* **버킷 이름에 점(.) 포함 시 HTTPS 인증서 문제**
  예: `my.bucket.name.s3.amazonaws.com` → SAN 와일드카드 매칭 불가 가능성
* **대소문자 구분**: 객체 Key는 대소문자 구분함.
* **특수문자 인코딩 필요**: 공백(`%20`), 한글(`%EC%...`) 등 URL 인코딩 필수
* **CloudFront 권장**: S3 퍼블릭 직접 노출은 보안 취약(Hotlink, URL 수집 가능)

---
