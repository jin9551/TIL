# í”„ë¡ì‹œ íŒ¨í„´(Proxy Pattern)ì´ë€?

í”„ë¡ì‹œ íŒ¨í„´(Proxy Pattern)ì€ **GoF(ë””ìì¸ íŒ¨í„´)ì—ì„œ êµ¬ì¡° íŒ¨í„´(Structural Pattern)** ì¤‘ í•˜ë‚˜ë¡œ, **ì–´ë–¤ ê°ì²´ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê±°ë‚˜ ê¸°ëŠ¥ì„ ì¶”ê°€**í•˜ê¸° ìœ„í•´ **ê·¸ ê°ì²´ì˜ ëŒ€ë¦¬(proxy) ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´**ì…ë‹ˆë‹¤.

---

## âœ… í•µì‹¬ ê°œë…

* \*\*ì‹¤ì œ ê°ì²´(Real Subject)\*\*ì— ëŒ€í•œ **ì ‘ê·¼ì„ ì œì–´**í•˜ê±°ë‚˜, **ì¶”ê°€ì ì¸ ê¸°ëŠ¥**ì„ ì œê³µí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
* í´ë¼ì´ì–¸íŠ¸ëŠ” ì‹¤ì œ ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  **í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ì‚¬ìš©**

---

## âœ… êµ¬ì„± ìš”ì†Œ

| ì—­í•             | ì„¤ëª…                                           |
| ------------- | -------------------------------------------- |
| `Subject`     | ì‹¤ì œ ê°ì²´ì™€ í”„ë¡ì‹œ ê°ì²´ê°€ ê³µí†µìœ¼ë¡œ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤                |
| `RealSubject` | ì‹¤ì œ í•µì‹¬ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤                           |
| `Proxy`       | `RealSubject`ë¥¼ ì°¸ì¡°í•˜ê³ , ì ‘ê·¼ ì œì–´/ë¡œê¹…/ì§€ì—°ì´ˆê¸°í™” ë“±ì˜ ê¸°ëŠ¥ ì¶”ê°€ |

---

## âœ… UML êµ¬ì¡°

```
Client --> Proxy --> RealSubject
```

---

## âœ… Java ì˜ˆì œ

### 1. Subject ì¸í„°í˜ì´ìŠ¤

```java
public interface Image {
    void display();
}
```

### 2. RealSubject: ì‹¤ì œ ì´ë¯¸ì§€

```java
public class RealImage implements Image {
    private String filename;

    public RealImage(String filename) {
        this.filename = filename;
        loadFromDisk(); // ë¬´ê±°ìš´ ì‘ì—…
    }

    private void loadFromDisk() {
        System.out.println("Loading " + filename);
    }

    public void display() {
        System.out.println("Displaying " + filename);
    }
}
```

### 3. Proxy: ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ ì§€ì—° ì´ˆê¸°í™”

```java
public class ProxyImage implements Image {
    private RealImage realImage;
    private String filename;

    public ProxyImage(String filename) {
        this.filename = filename;
    }

    public void display() {
        if (realImage == null) {
            realImage = new RealImage(filename); // ì‹¤ì œ ê°ì²´ ìƒì„±ì€ í•„ìš”í•  ë•Œë§Œ
        }
        realImage.display();
    }
}
```

### 4. Client

```java
public class ProxyPatternTest {
    public static void main(String[] args) {
        Image image = new ProxyImage("sample.jpg");

        System.out.println("ì´ë¯¸ì§€ë¥¼ ì²˜ìŒ í˜¸ì¶œí•©ë‹ˆë‹¤.");
        image.display();  // ì—¬ê¸°ì„œë§Œ ì‹¤ì œ ì´ë¯¸ì§€ ë¡œë”©

        System.out.println("ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤.");
        image.display();  // ìºì‹œëœ ê°ì²´ ì‚¬ìš©
    }
}
```

---

## âœ… ì‚¬ìš© ëª©ì ì— ë”°ë¥¸ ë¶„ë¥˜

| ì¢…ë¥˜                   | ì„¤ëª…                               |
| -------------------- | -------------------------------- |
| **Virtual Proxy**    | ë¬´ê±°ìš´ ê°ì²´ì˜ ìƒì„±ì„ ì§€ì—° (ex. ì´ë¯¸ì§€ ë¡œë”©)      |
| **Protection Proxy** | ì ‘ê·¼ ê¶Œí•œ ì œì–´ (ex. ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥ ì œí•œ)      |
| **Remote Proxy**     | ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì›ê²© ê°ì²´ì™€ í†µì‹  (ex. RMI)     |
| **Smart Proxy**      | ê°ì²´ ì ‘ê·¼ ì „/í›„ì— ë¶€ê°€ ë™ì‘ ìˆ˜í–‰ (ex. ë¡œê¹…, ìºì‹±) |

---

## âœ… ì–¸ì œ ì“°ëŠ”ê°€?

* ì‹¤ì œ ê°ì²´ ìƒì„± ë¹„ìš©ì´ í´ ë•Œ (â†’ ê°€ìƒ í”„ë¡ì‹œ)
* ë³´ì•ˆ/ê¶Œí•œ ì œì–´ê°€ í•„ìš”í•  ë•Œ (â†’ ë³´í˜¸ í”„ë¡ì‹œ)
* ê°ì²´ ì ‘ê·¼ ì‹œ ë¶€ê°€ê¸°ëŠ¥ì„ ë„£ê³  ì‹¶ì„ ë•Œ (â†’ ìŠ¤ë§ˆíŠ¸ í”„ë¡ì‹œ)
* ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ ì›ê²© í˜¸ì¶œì„ ì¶”ìƒí™”í•˜ê³  ì‹¶ì„ ë•Œ (â†’ ì›ê²© í”„ë¡ì‹œ)

---

## âœ… ì‹¤ì œ ì˜ˆì‹œ

* `Spring AOP`ì—ì„œ `@Transactional`, `@Cacheable` ë“±ì˜ ë¶€ê°€ê¸°ëŠ¥ ì ìš© ì‹œ â†’ ë‚´ë¶€ì ìœ¼ë¡œ **í”„ë¡ì‹œ ê°ì²´ ìƒì„±**
* `Hibernate`ì—ì„œ `LAZY` ë¡œë”© â†’ ì—”í‹°í‹° í”„ë¡ì‹œ ì‚¬ìš©
* `java.lang.reflect.Proxy` â†’ ë™ì  í”„ë¡ì‹œ êµ¬í˜„

---

# Java ì˜ˆì œ ì„¤ëª…

ì¢‹ì€ ì§ˆë¬¸ì´ì•¼. ì˜ˆì œë¥¼ í•˜ë‚˜í•˜ë‚˜ ëœ¯ì–´ë³´ë©´ì„œ ì„¤ëª…í• ê²Œ. í•µì‹¬ì€ `ProxyImage`ê°€ **ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ í•„ìš”í•œ ì‹œì ì—ë§Œ ìƒì„±**í•˜ë„ë¡ í•˜ê¸° ë•Œë¬¸ì— \*\*"ì§€ì—° ì´ˆê¸°í™”(lazy initialization)"\*\*ê°€ ë°œìƒí•˜ê³ , ê·¸ ì´í›„ì—” **ìƒì„±ëœ ê°ì²´ë¥¼ ì¬ì‚¬ìš©**í•˜ë¯€ë¡œ **ìºì‹±ëœ ê²ƒì²˜ëŸ¼ ë™ì‘**í•˜ëŠ” ê±°ì•¼.

---

## ğŸ’¡ ProxyImageì—ì„œì˜ í•µì‹¬ ì½”ë“œ

```java
public class ProxyImage implements Image {
    private RealImage realImage;
    private String filename;

    public ProxyImage(String filename) {
        this.filename = filename;
    }

    public void display() {
        if (realImage == null) {
            realImage = new RealImage(filename); // ì‹¤ì œ ê°ì²´ëŠ” ì—¬ê¸°ì„œ ìƒì„±ë¨
        }
        realImage.display();
    }
}
```

---

## âœ… 1. ì™œ `display()`ê°€ ë”œë ˆì´ ë˜ëŠ”ê°€?

* ìƒì„±ìì—ì„œëŠ” ì‹¤ì œ `RealImage`ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , ë‹¨ìˆœíˆ `filename`ë§Œ ì €ì¥í•´ë‘¬.
* `display()`ê°€ í˜¸ì¶œë˜ê¸° ì „ê¹Œì§€ëŠ” `realImage == null` ìƒíƒœì•¼.
* ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ì´ë¯¸ì§€ë¥¼ ë³´ë ¤ê³  `display()`ë¥¼ í˜¸ì¶œí–ˆì„ ë•Œë§Œ,

  ```java
  realImage = new RealImage(filename);
  ```

  ì´ ì‹¤í–‰ë˜ë©´ì„œ `RealImage`ê°€ ìƒì„±ë˜ê³ , `loadFromDisk()`ê°€ ì‹¤í–‰ë¨.

â†’ ì¦‰, **í•„ìš”í•  ë•Œê¹Œì§€ ê°ì²´ ìƒì„±ì„ ë¯¸ë£¬ ê²ƒ**ì´ì•¼.
â†’ ì´ê²Œ \*\*ì§€ì—° ì´ˆê¸°í™”(lazy loading)\*\*ì˜ ëŒ€í‘œì ì¸ ì˜ˆì•¼.

---

## âœ… 2. ì™œ ìºì‹œëœ ê°ì²´ê°€ ì¬ì‚¬ìš©ë˜ëŠ”ê°€?

* `realImage`ëŠ” `ProxyImage` ê°ì²´ ì•ˆì— **ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¡œ ì €ì¥**ë¨.

```java
private RealImage realImage; // ìƒì„±ëœ í›„ ì¬ì‚¬ìš©
```

* `display()`ê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ì–´ë„ `realImage`ëŠ” ì´ë¯¸ ë§Œë“¤ì–´ì¡Œê¸° ë•Œë¬¸ì—,

  ```java
  if (realImage == null) // false
  ```

  ì¡°ê±´ë¬¸ì„ ê±´ë„ˆë›°ê³  ë°”ë¡œ

  ```java
  realImage.display();
  ```

  ë¥¼ ì‹¤í–‰í•´.

â†’ ì´ë•ŒëŠ” **ë””ìŠ¤í¬ì—ì„œ ë‹¤ì‹œ ë¡œë”©(loadFromDisk)** í•˜ì§€ ì•Šê³ ,
ì´ë¯¸ ë©”ëª¨ë¦¬ì— ìˆëŠ” **ìºì‹œëœ RealImage ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©**í•¨.

---

## âœ… ì‹¤í–‰ ìˆœì„œë¥¼ ì‹¤ì œë¡œ ë³´ë©´

```java
Image image = new ProxyImage("sample.jpg"); // ì•„ì§ RealImage ìƒì„± ì•ˆ ë¨

System.out.println("ì´ë¯¸ì§€ë¥¼ ì²˜ìŒ í˜¸ì¶œí•©ë‹ˆë‹¤.");
image.display();  
// RealImage ìƒì„±ë¨ â†’ loadFromDisk â†’ display

System.out.println("ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤.");
image.display();  
// ì´ë¯¸ ìƒì„±ëœ RealImage ì‚¬ìš© â†’ ë°”ë¡œ display
```

ì¶œë ¥ ê²°ê³¼:

```
ì´ë¯¸ì§€ë¥¼ ì²˜ìŒ í˜¸ì¶œí•©ë‹ˆë‹¤.
Loading sample.jpg
Displaying sample.jpg

ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤.
Displaying sample.jpg
```

---

## âœ… ì •ë¦¬

| ì‹œì                     | RealImage ìƒì„±ë¨? | ì´ìœ                               |
| --------------------- | -------------- | ------------------------------- |
| `new ProxyImage(...)` | âŒ              | ë‹¨ìˆœíˆ íŒŒì¼ëª… ì €ì¥ë§Œ í•¨                   |
| ì²« `display()` í˜¸ì¶œ      | âœ…              | realImageê°€ nullì´ë¯€ë¡œ ìƒì„±ë¨ + ë””ìŠ¤í¬ ë¡œë“œ |
| ë‘ ë²ˆì§¸ `display()` í˜¸ì¶œ   | âŒ              | ì´ë¯¸ ìƒì„±ëœ ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•¨ (ìºì‹œë¨)           |

---

## âœ… ì™œ ì´ëŸ° êµ¬ì¡°ê°€ í•„ìš”í•œê°€?

* ì´ë¯¸ì§€, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ëŒ€ìš©ëŸ‰ íŒŒì¼ ë“± **ë¬´ê²ê³  ëŠë¦° ê°ì²´ì˜ ìƒì„±ì„ ì§€ì—°ì‹œí‚´ìœ¼ë¡œì¨ ì„±ëŠ¥ì„ ìµœì í™”**í•  ìˆ˜ ìˆìŒ.
* í”„ë¡ì‹œëŠ” ì´ëŸ° ê°ì²´ë¥¼ **"ì§„ì§œ ì“¸ ë•Œë§Œ ë§Œë“¤ë„ë¡" í†µì œ**í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì  ì¥ì ì´ ìˆìŒ.

---


